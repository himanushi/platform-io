<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0"
    />
    <title>Easy Setting</title>
    <link rel="stylesheet" href="/modern-normalize.min.css" />
    <script type="text/javascript" src="/van.min.js"></script>
    <script type="module">
      const { input, button, div, span, pre, p } = van.tags;

      const Settings = async () => {
        const groups = await fetch("/settings.json").then((res) => res.json());
        const formData = {};

        const onInput = (setting, e) => {
          formData[setting.key] = e.target.value;
        };

        const onSave = () => {
          fetch("/settings", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          })
            .then((response) => response.json())
            .then((data) => console.log(data))
            .catch((error) => console.error("Error:", error));
        };

        return div(
          ...groups.map((group) =>
            group.settings.map((setting) => [
              span(setting.label),
              input({
                type: setting.type,
                name: setting.name,
                oninput: (e) => onInput(setting, e),
              }),
            ]),
          ),
          button({ onclick: onSave }, "Save"),
        );
      };

      (async () => {
        van.add(document.body, await Settings());
      })();
    </script>
  </head>
  <body></body>
</html>
